<!DOCTYPE html>
<html lang="ru">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>LoFi Radio</title>
   <script src="https://telegram.org/js/telegram-web-app.js"></script>
   <style>
       body, html { 
           margin: 0; 
           padding: 0; 
           width: 100%; 
           height: 100%; 
           overflow: hidden; 
           font-family: Arial, sans-serif; 
           color: #fff;
           transition: all 0.3s ease;
       }
       
       /* –í–∏–¥–µ–æ—Ñ–æ–Ω */
       #bg-video { 
           position: fixed; 
           top: 0; 
           left: 0; 
           width: 100%; 
           height: 100%; 
           object-fit: cover; 
           z-index: -1;
           transition: opacity 0.5s ease;
       }
       
       /* Telegram —Ç–µ–º–∞ (—Ñ–æ–Ω –±–µ–∑ –≤–∏–¥–µ–æ) */
       .theme-telegram {
           background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
       }
       
       .controls { 
           position: relative; 
           z-index: 1; 
           background: rgba(0,0,0,0.7);
           padding: 20px; 
           border-radius: 12px; 
           max-width: 400px; 
           margin: 50px auto; 
           text-align: center;
           border: 1px solid rgba(255,255,255,0.2);
           box-shadow: 0 4px 20px rgba(0,0,0,0.3);
       }
       
       h1 { 
           margin-bottom: 20px; 
           font-size: 24px;
           color: #fff;
       }
       
       select, button, input[type=range] { 
           width: 100%; 
           margin: 10px 0; 
           padding: 10px; 
           border-radius: 8px; 
           border: none; 
           font-size: 16px; 
       }
       
       select { 
           background-color: #333; 
           color: #fff;
           border: 1px solid #555;
       }
       
       button { 
           cursor: pointer; 
           background-color: #ff6f61; 
           color: white; 
           font-weight: bold; 
           transition: transform 0.2s, background-color 0.2s; 
           border: none;
       }
       
       button:hover { 
           transform: scale(1.05); 
           background-color: #ff4b3e;
       }
       
       button:disabled { 
           background-color: #666; 
           cursor: not-allowed; 
           transform: none; 
       }
       
       input[type=range] { 
           -webkit-appearance: none; 
           background: #444; 
           height: 8px; 
       }
       
       input[type=range]::-webkit-slider-thumb { 
           -webkit-appearance: none; 
           width: 20px; 
           height: 20px; 
           background: #ff6f61; 
           border-radius: 50%; 
           cursor: pointer; 
       }
       
       input[type=range]::-moz-range-thumb {
           width: 20px; 
           height: 20px; 
           background: #ff6f61; 
           border-radius: 50%; 
           cursor: pointer;
           border: none;
       }
       
       .loading { 
           display: none; 
           font-size: 14px; 
           color: #ff6f61; 
       }
       
       .volume-container { 
           margin: 10px 0; 
       }
       
       .mobile-note { 
           font-size: 12px; 
           color: #999; 
           margin-top: 5px; 
           display: none; 
       }
       
       /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º */
       .themes-container {
           margin: 15px 0;
           padding: 10px;
           background: rgba(255,255,255,0.1);
           border-radius: 8px;
           border: 1px solid rgba(255,255,255,0.1);
       }
       
       .themes-title {
           font-size: 14px;
           margin-bottom: 10px;
           color: #fff;
           font-weight: bold;
       }
       
       .themes-grid {
           display: grid;
           grid-template-columns: repeat(3, 1fr);
           gap: 8px;
       }
       
       .theme-btn {
           padding: 8px 12px;
           font-size: 12px;
           border-radius: 6px;
           background: rgba(255,255,255,0.2);
           color: #fff;
           border: 2px solid transparent;
           cursor: pointer;
           transition: all 0.2s ease;
           margin: 2px;
       }
       
       .theme-btn:hover {
           transform: scale(1.02);
           background: rgba(255,255,255,0.3);
       }
       
       .theme-btn.active {
           border-color: #ff6f61;
           background: #ff6f61;
           color: white;
       }
       
       /* –õ–µ–π–±–ª –¥–ª—è –≥—Ä–æ–º–∫–æ—Å—Ç–∏ */
       label {
           color: #fff;
           font-size: 14px;
       }
       
       @media (max-width: 768px) {
           .mobile-note { 
               display: block; 
           }
           
           .controls {
               margin: 20px auto;
               max-width: 350px;
               padding: 15px;
           }
           
           h1 {
               font-size: 20px;
           }
           
           .themes-grid {
               grid-template-columns: repeat(3, 1fr);
           }
           
           .theme-btn {
               font-size: 11px;
               padding: 6px 8px;
           }
           
           select, button {
               font-size: 14px;
               padding: 8px;
           }
       }
       
       /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ª—É—á—à–µ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ */
       * {
           -webkit-tap-highlight-color: transparent;
       }
       
       select:focus, button:focus {
           outline: 2px solid #ff6f61;
           outline-offset: 2px;
       }
   </style>
</head>
<body>
   <video autoplay muted loop playsinline id="bg-video">
       <source src="https://nikitataflowny-create.github.io/tg-lofi-radio/bg.mp4" type="video/mp4">
       –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
   </video>

   <div class="controls">
       <h1 id="station-name">LoFi Radio</h1>
       
       <select id="station-select">
           <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞–Ω—Ü–∏—é</option>
       </select>
       
       <button id="play-pause" disabled>‚ñ∂Ô∏è Play</button>
       
       <div class="loading" id="loading">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</div>
       
       <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º -->
       <div class="themes-container">
           <div class="themes-title">üé® –¢–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</div>
           <div class="themes-grid" id="themes-grid">
               <!-- –¢–µ–º—ã –∑–∞–≥—Ä—É–∑—è—Ç—Å—è —á–µ—Ä–µ–∑ JavaScript -->
           </div>
       </div>
       
       <div class="volume-container">
           <label for="volume">–ì—Ä–æ–º–∫–æ—Å—Ç—å:</label>
           <input type="range" id="volume" min="0" max="1" step="0.01" value="0.5">
           <div class="mobile-note">–ù–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –≥—Ä–æ–º–∫–æ—Å—Ç–∏</div>
       </div>
   </div>

   <audio id="audio" preload="none"></audio>

   <script>
       // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–µ–º
       const themes = [
           {
               id: 'city',
               name: '1',
               video: 'bg.mp4',
               description: '–¢–µ–º–∞ 1'
           },
           {
               id: 'studio',
               name: '2',
               video: 'video2.mp4',
               description: '–¢–µ–º–∞ 2'
           },
           {
               id: 'room',
               name: '3',
               video: 'video3.mp4',
               description: '–¢–µ–º–∞ 3'
           },
           {
               id: 'fourth',
               name: '4',
               video: 'video4.mp4',
               description: '–¢–µ–º–∞ 4'
           },
           {
               id: 'telegram',
               name: 'Telegram',
               video: null,
               description: '–¶–≤–µ—Ç–∞ –∏–∑ –≤–∞—à–µ–≥–æ Telegram'
           }
       ];

       // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å—Ç–∞–Ω—Ü–∏–π
       const stations = [
           {
               id: 1,
               name: "Beats",
               url: "https://stream.laut.fm/lofi"
           },
           {
               id: 2,
               name: "24/7",
               url: "https://ec3.yesstreaming.net:3755/stream"
           },
           {
               id: 3,
               name: "Chill",
               url: "https://chill.radioca.st/stream"
           },
           {
               id: 4,
               name: "ChillOut",
               url: "https://stream.laut.fm/chillout"
           },
           {
               id: 5,
               name: "Live",
               url: "https://live.lofiradio.ru/lofi_mp3_128"
           },
           {
               id: 6,
               name: "LoF",
               url: "https://play.lofiradio.ru:8000/mp3_320"
           }
       ];

       // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
       const video = document.getElementById('bg-video');
       const audio = document.getElementById('audio');
       const playPauseBtn = document.getElementById('play-pause');
       const volumeSlider = document.getElementById('volume');
       const stationSelect = document.getElementById('station-select');
       const stationName = document.getElementById('station-name');
       const loading = document.getElementById('loading');
       const themesGrid = document.getElementById('themes-grid');

       let currentStation = null;
       let currentTheme = 'city'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
       let isPlaying = false;

       // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
       function init() {
           // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
           if (window.Telegram?.WebApp) {
               window.Telegram.WebApp.ready();
               window.Telegram.WebApp.expand();
               // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–º—É
               document.body.style.backgroundColor = window.Telegram.WebApp.backgroundColor || '#000';
           }
           
           loadStations();
           loadThemes();
           setupEventListeners();
           loadSavedTheme();
       }

       // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞–Ω—Ü–∏–π
       function loadStations() {
           stationSelect.innerHTML = '<option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞–Ω—Ü–∏—é</option>';
           
           stations.forEach(station => {
               const option = document.createElement('option');
               option.value = station.id;
               option.textContent = station.name;
               option.dataset.station = JSON.stringify(station);
               stationSelect.appendChild(option);
           });
       }

       // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–º
       function loadThemes() {
           themesGrid.innerHTML = '';
           
           themes.forEach(theme => {
               const button = document.createElement('button');
               button.className = 'theme-btn';
               button.textContent = theme.name;
               button.title = theme.description;
               button.onclick = () => changeTheme(theme.id);
               
               if (theme.id === currentTheme) {
                   button.classList.add('active');
               }
               
               themesGrid.appendChild(button);
           });
       }

       // –°–º–µ–Ω–∞ —Ç–µ–º—ã
       function changeTheme(themeId) {
           const theme = themes.find(t => t.id === themeId);
           if (!theme) return;

           currentTheme = themeId;
           
           // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
           document.querySelectorAll('.theme-btn').forEach(btn => {
               btn.classList.remove('active');
           });
           event.target.classList.add('active');

           if (theme.video) {
               // –í–∏–¥–µ–æ —Ç–µ–º–∞
               document.body.classList.remove('theme-telegram');
               video.style.display = 'block';
               
               // –ü–ª–∞–≤–Ω–∞—è —Å–º–µ–Ω–∞ –≤–∏–¥–µ–æ
               video.style.opacity = '0';
               setTimeout(() => {
                   video.src = `https://nikitataflowny-create.github.io/tg-lofi-radio/${theme.video}`;
                   video.style.opacity = '1';
                   video.play().catch(e => console.log('Video autoplay failed:', e));
               }, 200);
           } else {
               // Telegram —Ü–≤–µ—Ç–∞
               video.style.opacity = '0';
               setTimeout(() => {
                   video.style.display = 'none';
                   document.body.classList.add('theme-telegram');
               }, 200);
           }

           // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±–æ—Ä
           try {
               localStorage.setItem('lofi-theme', themeId);
           } catch (e) {
               console.log('LocalStorage not available');
           }
       }

       // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π —Ç–µ–º—ã
       function loadSavedTheme() {
           try {
               const savedTheme = localStorage.getItem('lofi-theme');
               if (savedTheme && themes.find(t => t.id === savedTheme)) {
                   // –ù–∞—Ö–æ–¥–∏–º –∫–Ω–æ–ø–∫—É —Ç–µ–º—ã –∏ –∫–ª–∏–∫–∞–µ–º –Ω–∞ –Ω–µ—ë
                   setTimeout(() => {
                       const themeButton = Array.from(document.querySelectorAll('.theme-btn'))
                           .find(btn => btn.textContent === themes.find(t => t.id === savedTheme).name);
                       if (themeButton) {
                           themeButton.click();
                       }
                   }, 500);
               }
           } catch (e) {
               console.log('LocalStorage not available');
           }
       }

       // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
       function setupEventListeners() {
           playPauseBtn.addEventListener('click', togglePlayPause);
           volumeSlider.addEventListener('input', updateVolume);
           stationSelect.addEventListener('change', changeStation);
           
           audio.addEventListener('loadstart', () => showLoading(true));
           audio.addEventListener('loadeddata', () => showLoading(false));
           audio.addEventListener('error', handleAudioError);
           audio.addEventListener('play', () => updatePlayButton(true));
           audio.addEventListener('pause', () => updatePlayButton(false));
       }

       // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
       function togglePlayPause() {
           if (!currentStation) return;

           if (audio.paused) {
               audio.play().catch(handleAudioError);
           } else {
               audio.pause();
           }
       }

       // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
       function updateVolume() {
           try {
               audio.volume = volumeSlider.value;
           } catch (e) {
               console.log('Volume control not supported on this device');
           }
       }

       // –°–º–µ–Ω–∞ —Å—Ç–∞–Ω—Ü–∏–∏
       function changeStation() {
           const selectedOption = stationSelect.selectedOptions[0];
           if (!selectedOption) return;

           currentStation = JSON.parse(selectedOption.dataset.station);
           
           // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ
           stationName.textContent = currentStation.name;
           
           // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
           audio.pause();
           
           // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–æ–≤—É—é —Å—Ç–∞–Ω—Ü–∏—é
           audio.src = currentStation.url;
           audio.load();
           
           // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
           playPauseBtn.disabled = false;
           
           // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—á–∏–Ω–∞–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
           audio.play().catch(handleAudioError);
       }

       // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
       function showLoading(show) {
           loading.style.display = show ? 'block' : 'none';
       }

       // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
       function updatePlayButton(playing) {
           isPlaying = playing;
           playPauseBtn.textContent = playing ? '‚è∏Ô∏è Pause' : '‚ñ∂Ô∏è Play';
       }

       // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∞—É–¥–∏–æ
       function handleAudioError(error) {
           console.error('Audio error:', error);
           showLoading(false);
           updatePlayButton(false);
       }

       // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
       init();
   </script>
</body>
</html>
