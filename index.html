<!DOCTYPE html>
<html lang="ru">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>LoFi Radio</title>
   <script src="https://telegram.org/js/telegram-web-app.js"></script>
   <style>
       body, html { 
           margin: 0; 
           padding: 0; 
           width: 100%; 
           height: 100%; 
           overflow: hidden; 
           font-family: Arial, sans-serif; 
           color: #fff;
           transition: all 0.3s ease;
       }
       
       #bg-video { 
           position: fixed; 
           top: 0; 
           left: 0; 
           width: 100%; 
           height: 100%; 
           object-fit: cover; 
           z-index: -1;
           transition: opacity 0.5s ease;
       }
       
       .theme-telegram {
           background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
       }
       
       .controls { 
           position: relative; 
           z-index: 1; 
           background: rgba(0,0,0,0.4);
           padding: 20px; 
           border-radius: 12px; 
           max-width: 400px; 
           margin: 50px auto; 
           text-align: center;
           border: 1px solid rgba(255,255,255,0.3);
           box-shadow: 0 4px 20px rgba(0,0,0,0.2);
       }
       
       h1 { 
           margin-bottom: 20px; 
           font-size: 24px;
           color: #fff;
           text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
       }
       
       select, button, input[type=range] { 
           width: 100%; 
           margin: 10px 0; 
           padding: 10px; 
           border-radius: 8px; 
           border: none; 
           font-size: 16px; 
       }
       
       select { 
           background-color: rgba(51,51,51,0.9);
           color: #fff;
           border: 1px solid rgba(255,255,255,0.3);
       }
       
       button { 
           cursor: pointer; 
           background-color: #ff6f61; 
           color: white; 
           font-weight: bold; 
           transition: transform 0.2s, background-color 0.2s; 
           border: none;
       }
       
       button:hover { 
           transform: scale(1.05); 
           background-color: #ff4b3e;
       }
       
       button:disabled { 
           background-color: #666; 
           cursor: not-allowed; 
           transform: none; 
       }
       
       input[type=range] { 
           -webkit-appearance: none; 
           background: #444; 
           height: 8px; 
       }
       
       input[type=range]::-webkit-slider-thumb { 
           -webkit-appearance: none; 
           width: 20px; 
           height: 20px; 
           background: #ff6f61; 
           border-radius: 50%; 
           cursor: pointer; 
       }
       
       input[type=range]::-moz-range-thumb {
           width: 20px; 
           height: 20px; 
           background: #ff6f61; 
           border-radius: 50%; 
           cursor: pointer;
           border: none;
       }
       
       .loading { 
           display: none; 
           font-size: 14px; 
           color: #ff6f61; 
       }
       
       .volume-container { 
           margin: 10px 0; 
       }
       
       .mobile-note { 
           font-size: 12px; 
           color: #ccc; 
           margin-top: 5px; 
           display: none;
           text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
       }
       
       .themes-container {
           margin: 15px 0;
           padding: 10px;
           background: rgba(255,255,255,0.15);
           border-radius: 8px;
           border: 1px solid rgba(255,255,255,0.2);
       }
       
       .themes-title {
           font-size: 14px;
           margin-bottom: 10px;
           color: #fff;
           font-weight: bold;
           text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
       }
       
       .themes-grid {
           display: grid;
           grid-template-columns: repeat(3, 1fr);
           gap: 8px;
       }
       
       .theme-btn {
           padding: 8px 12px;
           font-size: 12px;
           border-radius: 6px;
           background: rgba(255,255,255,0.25);
           color: #fff;
           border: 2px solid transparent;
           cursor: pointer;
           transition: all 0.2s ease;
           margin: 2px;
           text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
       }
       
       .theme-btn:hover {
           transform: scale(1.02);
           background: rgba(255,255,255,0.35);
       }
       
       .theme-btn.active {
           border-color: #ff6f61;
           background: #ff6f61;
           color: white;
           text-shadow: none;
       }
       
       label {
           color: #fff;
           font-size: 14px;
           text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
       }

       #subscription-status {
           position: fixed;
           top: 10px;
           right: 10px;
           background: rgba(255, 255, 255, 0.9);
           padding: 5px 12px;
           border-radius: 15px;
           font-size: 12px;
           color: #333;
           z-index: 1000;
           display: none;
       }

       #access-blocked {
           position: fixed;
           top: 0;
           left: 0;
           width: 100vw;
           height: 100vh;
           background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
           display: none;
           justify-content: center;
           align-items: center;
           z-index: 10000;
           font-family: Arial, sans-serif;
       }

       .block-content {
           background: rgba(255, 255, 255, 0.95);
           border-radius: 20px;
           padding: 30px;
           text-align: center;
           max-width: 400px;
           margin: 20px;
           box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
       }

       .block-icon {
           font-size: 64px;
           margin-bottom: 20px;
       }

       .block-content h2 {
           color: #333;
           margin: 0 0 10px 0;
           font-size: 24px;
           font-weight: 600;
       }

       .block-status {
           color: #666;
           font-size: 16px;
           margin: 0 0 20px 0;
       }

       .block-description {
           color: #555;
           line-height: 1.5;
           margin-bottom: 25px;
       }

       .subscription-benefits {
           background: rgba(102, 126, 234, 0.1);
           border-radius: 15px;
           padding: 20px;
           margin: 20px 0;
       }

       .subscription-benefits h3 {
           margin: 0 0 15px 0;
           color: #4c63d2;
           font-size: 18px;
       }

       .subscription-benefits ul {
           list-style: none;
           padding: 0;
           margin: 0;
       }

       .subscription-benefits li {
           padding: 5px 0;
           color: #555;
       }

       .subscription-options {
           display: flex;
           gap: 15px;
           justify-content: center;
           margin: 25px 0;
       }

       .option {
           background: white;
           border: 2px solid #e1e5e9;
           border-radius: 12px;
           padding: 15px;
           min-width: 80px;
           position: relative;
           transition: all 0.3s ease;
       }

       .option.recommended {
           border-color: #4c63d2;
           transform: scale(1.05);
       }

       .save-badge {
           position: absolute;
           top: -8px;
           left: 50%;
           transform: translateX(-50%);
           background: #4c63d2;
           color: white;
           font-size: 10px;
           padding: 2px 8px;
           border-radius: 10px;
           font-weight: 600;
       }

       .price {
           display: block;
           font-size: 20px;
           font-weight: bold;
           color: #333;
       }

       .period {
           font-size: 12px;
           color: #666;
       }

       .save-text {
           display: block;
           font-size: 10px;
           color: #4c63d2;
           margin-top: 5px;
       }

       .return-btn {
           background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
           color: white;
           border: none;
           border-radius: 25px;
           padding: 15px 30px;
           font-size: 16px;
           font-weight: 600;
           cursor: pointer;
           margin: 20px 0 10px 0;
           transition: transform 0.2s ease;
           min-width: 200px;
       }

       .return-btn:hover {
           transform: translateY(-2px);
       }

       .referral-hint {
           font-size: 14px;
           color: #666;
           margin: 15px 0 0 0;
       }
       
       @media (max-width: 768px) {
           .mobile-note { 
               display: block; 
           }
           
           .controls {
               margin: 20px auto;
               max-width: 350px;
               padding: 15px;
           }
           
           h1 {
               font-size: 20px;
           }
           
           .themes-grid {
               grid-template-columns: repeat(3, 1fr);
           }
           
           .theme-btn {
               font-size: 11px;
               padding: 6px 8px;
           }
           
           select, button {
               font-size: 14px;
               padding: 8px;
           }

           .block-content {
               margin: 10px;
               padding: 20px;
           }
           
           .subscription-options {
               flex-direction: column;
               align-items: center;
           }
           
           .option {
               width: 120px;
           }
       }
       
       * {
           -webkit-tap-highlight-color: transparent;
       }
       
       select:focus, button:focus {
           outline: 2px solid #ff6f61;
           outline-offset: 2px;
       }
   </style>
</head>
<body>
   <div id="subscription-status"></div>

   <div id="access-blocked">
       <div class="block-content">
           <div class="block-icon">‚è∞</div>
           <h2>–î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω</h2>
           <p class="block-status" id="block-status-text">–î–æ—Å—Ç—É–ø –∏—Å—Ç–µ–∫</p>
           <p class="block-description">
               –î–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è LoFi —Ä–∞–¥–∏–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
           </p>
           
           <div class="subscription-benefits">
               <h3>üéµ –ß—Ç–æ –≤—Ö–æ–¥–∏—Ç –≤ –ø–æ–¥–ø–∏—Å–∫—É:</h3>
               <ul>
                   <li>üéµ 6 —Ä–∞–¥–∏–æ—Å—Ç–∞–Ω—Ü–∏–π –±–µ–∑ —Ä–µ–∫–ª–∞–º—ã</li>
                   <li>üé® 5 —Ç–µ–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</li>
                   <li>üìä –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∑–≤—É–∫–∞</li>
                   <li>‚ö° –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞</li>
               </ul>
           </div>
           
           <div class="subscription-options">
               <div class="option">
                   <span class="price">70‚ÇΩ</span>
                   <span class="period">/ –º–µ—Å—è—Ü</span>
               </div>
               <div class="option recommended">
                   <span class="save-badge">–í—ã–≥–æ–¥–Ω–æ!</span>
                   <span class="price">180‚ÇΩ</span>
                   <span class="period">/ 3 –º–µ—Å—è—Ü–∞</span>
                   <span class="save-text">—ç–∫–æ–Ω–æ–º–∏—è 14%</span>
               </div>
           </div>
           
           <button onclick="returnToBot()" class="return-btn">
               üí≥ –û—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
           </button>
           
           <p class="referral-hint">
               üí° –ò–ª–∏ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∏—Ç–µ –±–æ–Ω—É—Å–Ω—ã–µ –¥–Ω–∏!
           </p>
       </div>
   </div>

   <div id="main-content">
       <video autoplay muted loop playsinline id="bg-video">
           <source src="https://nikitataflowny-create.github.io/tg-lofi-radio/bg.mp4" type="video/mp4">
           –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
       </video>

       <div class="controls">
           <h1 id="station-name">LoFi Radio</h1>
           
           <select id="station-select">
               <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞–Ω—Ü–∏—é</option>
           </select>
           
           <button id="play-pause" disabled>‚ñ∂Ô∏è Play</button>
           
           <div class="loading" id="loading">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</div>
           
           <div class="themes-container">
               <div class="themes-title">üé® –¢–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</div>
               <div class="themes-grid" id="themes-grid">
               </div>
           </div>
           
           <div class="volume-container">
               <label for="volume">–ì—Ä–æ–º–∫–æ—Å—Ç—å:</label>
               <input type="range" id="volume" min="0" max="1" step="0.01" value="0.5">
               <div class="mobile-note">–ù–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –≥—Ä–æ–º–∫–æ—Å—Ç–∏</div>
           </div>
       </div>

       <audio id="audio" preload="none"></audio>
   </div>

   <script>
       // –ú–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º API URL
       class SubscriptionManager {
           constructor() {
               this.apiUrl = this.getApiUrl();
               this.userId = null;
               this.hasAccess = false;
           }

           getApiUrl() {
               // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ API URL
               const hostname = window.location.hostname;
               const protocol = window.location.protocol;
               
               // –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
               if (hostname === 'localhost' || hostname === '127.0.0.1') {
                   return 'http://localhost:8080/api/check-subscription';
               }
               
               // –î–ª—è GitHub Pages
               if (hostname.includes('github.io')) {
                   // –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º localhost –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                   return 'http://localhost:8080/api/check-subscription';
               }
               
               // –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ - —Ç–æ—Ç –∂–µ –¥–æ–º–µ–Ω —á—Ç–æ –∏ WebApp
               return `${protocol}//${hostname}/api/check-subscription`;
           }

           async init() {
               console.log('üîó Using API URL:', this.apiUrl);
               
               // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
               if (window.Telegram && window.Telegram.WebApp) {
                   const tg = window.Telegram.WebApp;
                   tg.ready();
                   
                   if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                       this.userId = tg.initDataUnsafe.user.id;
                       console.log('üë§ User ID:', this.userId);
                   } else {
                       console.warn('‚ö†Ô∏è No user data from Telegram WebApp');
                       this.userId = 12345;
                   }
               } else {
                   console.warn('‚ö†Ô∏è Not running in Telegram WebApp');
                   this.userId = 12345;
               }

               await this.checkSubscription();
           }

           async checkSubscription() {
               if (!this.userId) {
                   console.error('‚ùå No user ID available');
                   this.blockAccess('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
                   return;
               }

               try {
                   console.log('üîç Checking subscription for user', this.userId);
                   
                   const response = await fetch(`${this.apiUrl}/${this.userId}`, {
                       method: 'GET',
                       headers: {
                           'Content-Type': 'application/json',
                       },
                       mode: 'cors',
                       cache: 'no-cache'
                   });
                   
                   if (!response.ok) {
                       throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                   }
                   
                   const data = await response.json();
                   console.log('üìä Subscription status:', data);
                   
                   if (data.has_access) {
                       this.hasAccess = true;
                       this.allowAccess(data);
                   } else {
                       this.hasAccess = false;
                       this.blockAccess('–î–æ—Å—Ç—É–ø –∏—Å—Ç–µ–∫', data);
                   }
                   
               } catch (error) {
                   console.error('‚ùå Error checking subscription:', error);
                   
                   // –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
                   if (error.name === 'TypeError' && error.message.includes('fetch')) {
                       console.error('üåê Network error - API server unavailable');
                       this.showLimitedAccess();
                   } else {
                       console.log('üìÑ API error, showing limited access mode');
                       this.showLimitedAccess();
                   }
               }
           }
           
           // –ü–æ–∫–∞–∑–∞—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å API
           showLimitedAccess() {
               console.log('üéµ Showing limited access mode');
               this.hasAccess = true;
               this.allowAccess({ status: 'limited_access', message: '–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø' });
               
               // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
               const warning = document.createElement('div');
               warning.style.cssText = `
                   position: fixed;
                   top: 10px;
                   left: 50%;
                   transform: translateX(-50%);
                   background: #ff9800;
                   color: white;
                   padding: 10px 20px;
                   border-radius: 5px;
                   z-index: 10001;
                   font-size: 14px;
               `;
               warning.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏. –í—Ä–µ–º–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω.';
               document.body.appendChild(warning);
               
               setTimeout(() => {
                   if (warning.parentNode) {
                       warning.parentNode.removeChild(warning);
                   }
               }, 5000);
           }

           allowAccess(data) {
               console.log('‚úÖ Access granted');
               
               document.getElementById('main-content').style.display = 'block';
               document.getElementById('access-blocked').style.display = 'none';
               
               this.updateStatusDisplay(data);
           }

           blockAccess(reason, data = {}) {
               console.log('üö´ Access blocked:', reason);
               
               document.getElementById('main-content').style.display = 'none';
               this.showBlockScreen(reason, data);
           }

           showBlockScreen(reason, data) {
               const blockScreen = document.getElementById('access-blocked');
               const statusText = document.getElementById('block-status-text');
               
               const statusMessage = data.status === 'trial_expired' ? '–¢—Ä–∏–∞–ª –∏—Å—Ç–µ–∫' : 
                                  data.status === 'subscription_expired' ? '–ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞' : 
                                  '–î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω';

               statusText.textContent = statusMessage;
               blockScreen.style.display = 'flex';
           }

           updateStatusDisplay(data) {
               const statusElement = document.getElementById('subscription-status');
               if (data.status && data.status !== 'api_error' && data.status !== 'limited_access') {
                   const statusText = data.status === 'trial_active' ? 
                       `üéÅ –¢—Ä–∏–∞–ª: ${data.days_left || 0} –¥–Ω–µ–π` :
                       data.status === 'subscription_active' ? 
                       `‚≠ê –ü–æ–¥–ø–∏—Å–∫–∞: ${data.days_left || 0} –¥–Ω–µ–π` :
                       '';
                   
                   if (statusText) {
                       statusElement.textContent = statusText;
                       statusElement.style.display = 'block';
                   }
               }
           }
       }

       // –§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ –±–æ—Ç–∞
       function returnToBot() {
           if (window.Telegram && window.Telegram.WebApp) {
               window.Telegram.WebApp.close();
           } else {
               alert('–í–æ–∑–≤—Ä–∞—Ç –≤ –±–æ—Ç–∞...');
           }
       }

       // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–µ–º
       const themes = [
           {
               id: 'city',
               name: '1',
               video: 'bg.mp4',
               description: '–¢–µ–º–∞ 1'
           },
           {
               id: 'studio',
               name: '2',
               video: 'video2.mp4',
               description: '–¢–µ–º–∞ 2'
           },
           {
               id: 'room',
               name: '3',
               video: 'video3.mp4',
               description: '–¢–µ–º–∞ 3'
           },
           {
               id: 'fourth',
               name: '4',
               video: 'video4.mp4',
               description: '–¢–µ–º–∞ 4'
           },
           {
               id: 'telegram',
               name: 'Telegram',
               video: null,
               description: '–¶–≤–µ—Ç–∞ –∏–∑ –≤–∞—à–µ–≥–æ Telegram'
           }
       ];

       // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
       const video = document.getElementById('bg-video');
       const audio = document.getElementById('audio');
       const playPauseBtn = document.getElementById('play-pause');
       const volumeSlider = document.getElementById('volume');
       const stationSelect = document.getElementById('station-select');
       const stationName = document.getElementById('station-name');
       const loading = document.getElementById('loading');
       const themesGrid = document.getElementById('themes-grid');

       let currentStation = null;
       let currentTheme = 'city';
       let isPlaying = false;
       let subscriptionManager;

       // –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞–Ω—Ü–∏–π –∏–∑ API
       async function loadStationsFromAPI() {
           try {
               const apiUrl = subscriptionManager.apiUrl.replace('/check-subscription', '/stations');
               console.log('üìª Loading stations from:', apiUrl);
               
               const response = await fetch(apiUrl, {
                   method: 'GET',
                   headers: {
                       'Content-Type': 'application/json',
                   },
                   mode: 'cors',
                   cache: 'no-cache'
               });
               
               if (response.ok) {
                   const data = await response.json();
                   console.log('üìª –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Å—Ç–∞–Ω—Ü–∏–π –∏–∑ API:', data.stations.length);
                   console.log('üìä –í—Å–µ–≥–æ —Å—Ç–∞–Ω—Ü–∏–π:', data.total_all, '–ê–∫—Ç–∏–≤–Ω—ã—Ö:', data.total_active);
                   return data.stations;
               } else {
                   console.log('‚ö†Ô∏è API –æ—Ç–≤–µ—Ç–∏–ª —Å –æ—à–∏–±–∫–æ–π:', response.status);
               }
           } catch (error) {
               console.log('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞–Ω—Ü–∏–∏ –∏–∑ API:', error.message);
           }
           
           // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞—Ç–∏—á–Ω—ã–µ —Å—Ç–∞–Ω—Ü–∏–∏ –∫–∞–∫ fallback
           console.log('üìª –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞—Ç–∏—á–Ω—ã–µ —Å—Ç–∞–Ω—Ü–∏–∏ –∫–∞–∫ fallback');
           return [
               { id: 1, name: "Beats", url: "https://stream.laut.fm/lofi" },
               { id: 2, name: "24/7", url: "https://ec3.yesstreaming.net:3755/stream" },
               { id: 3, name: "Chill", url: "https://chill.radioca.st/stream" },
               { id: 4, name: "ChillOut", url: "https://stream.laut.fm/chillout" },
               { id: 5, name: "Live", url: "https://live.lofiradio.ru/lofi_mp3_128" },
               { id: 6, name: "LoF", url: "https://play.lofiradio.ru:8000/mp3_320" }
           ];
       }

       // –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞–Ω—Ü–∏–π
       async function loadStations() {
           // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞–Ω—Ü–∏–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–∑ API
           const dynamicStations = await loadStationsFromAPI();
           
           stationSelect.innerHTML = '<option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞–Ω—Ü–∏—é</option>';
           
           dynamicStations.forEach(station => {
               const option = document.createElement('option');
               option.value = station.id;
               option.textContent = station.name;
               option.dataset.station = JSON.stringify(station);
               stationSelect.appendChild(option);
           });
           
           console.log(`üìª –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${dynamicStations.length} —Å—Ç–∞–Ω—Ü–∏–π –≤ —Å–µ–ª–µ–∫—Ç–æ—Ä`);
       }

       // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
       async function init() {
           if (window.Telegram?.WebApp) {
               window.Telegram.WebApp.ready();
               window.Telegram.WebApp.expand();
               document.body.style.backgroundColor = window.Telegram.WebApp.backgroundColor || '#000';
           }

           subscriptionManager = new SubscriptionManager();
           await subscriptionManager.init();

           if (subscriptionManager.hasAccess) {
               await loadStations(); // –ò–ó–ú–ï–ù–ï–ù–û: –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é –∑–∞–≥—Ä—É–∑–∫—É
               loadThemes();
               setupEventListeners();
               loadSavedTheme();
           }
       }

       function loadThemes() {
           themesGrid.innerHTML = '';
           
           themes.forEach(theme => {
               const button = document.createElement('button');
               button.className = 'theme-btn';
               button.textContent = theme.name;
               button.title = theme.description;
               button.onclick = () => changeTheme(theme.id);
               
               if (theme.id === currentTheme) {
                   button.classList.add('active');
               }
               
               themesGrid.appendChild(button);
           });
       }

       function changeTheme(themeId) {
           const theme = themes.find(t => t.id === themeId);
           if (!theme) return;

           currentTheme = themeId;
           
           document.querySelectorAll('.theme-btn').forEach(btn => {
               btn.classList.remove('active');
           });
           event.target.classList.add('active');

           if (theme.video) {
               document.body.classList.remove('theme-telegram');
               video.style.display = 'block';
               
               video.style.opacity = '0';
               setTimeout(() => {
                   video.src = `https://nikitataflowny-create.github.io/tg-lofi-radio/${theme.video}`;
                   video.style.opacity = '1';
                   video.play().catch(e => console.log('Video autoplay failed:', e));
               }, 200);
           } else {
               video.style.opacity = '0';
               setTimeout(() => {
                   video.style.display = 'none';
                   document.body.classList.add('theme-telegram');
               }, 200);
           }

           try {
               localStorage.setItem('lofi-theme', themeId);
           } catch (e) {
               console.log('LocalStorage not available');
           }
       }

       function loadSavedTheme() {
           try {
               const savedTheme = localStorage.getItem('lofi-theme');
               if (savedTheme && themes.find(t => t.id === savedTheme)) {
                   setTimeout(() => {
                       const themeButton = Array.from(document.querySelectorAll('.theme-btn'))
                           .find(btn => btn.textContent === themes.find(t => t.id === savedTheme).name);
                       if (themeButton) {
                           themeButton.click();
                       }
                   }, 500);
               }
           } catch (e) {
               console.log('LocalStorage not available');
           }
       }

       function setupEventListeners() {
           playPauseBtn.addEventListener('click', togglePlayPause);
           volumeSlider.addEventListener('input', updateVolume);
           stationSelect.addEventListener('change', changeStation);
           
           audio.addEventListener('loadstart', () => showLoading(true));
           audio.addEventListener('loadeddata', () => showLoading(false));
           audio.addEventListener('error', handleAudioError);
           audio.addEventListener('play', () => updatePlayButton(true));
           audio.addEventListener('pause', () => updatePlayButton(false));
       }

       function togglePlayPause() {
           if (!currentStation) return;

           if (audio.paused) {
               audio.play().catch(handleAudioError);
           } else {
               audio.pause();
           }
       }

       function updateVolume() {
           try {
               audio.volume = volumeSlider.value;
           } catch (e) {
               console.log('Volume control not supported on this device');
           }
       }

       function changeStation() {
           const selectedOption = stationSelect.selectedOptions[0];
           if (!selectedOption) return;

           currentStation = JSON.parse(selectedOption.dataset.station);
           
           stationName.textContent = currentStation.name;
           
           audio.pause();
           audio.src = currentStation.url;
           audio.load();
           
           playPauseBtn.disabled = false;
           audio.play().catch(handleAudioError);
       }

       function showLoading(show) {
           loading.style.display = show ? 'block' : 'none';
       }

       function updatePlayButton(playing) {
           isPlaying = playing;
           playPauseBtn.textContent = playing ? '‚è∏Ô∏è Pause' : '‚ñ∂Ô∏è Play';
       }

       function handleAudioError(error) {
           console.error('Audio error:', error);
           showLoading(false);
           updatePlayButton(false);
       }

       // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
       init();
   </script>
</body>
</html>
